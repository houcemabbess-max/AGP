<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

<h:head>
    <title>Recherche - AGP Réunion</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
          rel="stylesheet"/>

    <style>
        html, body { height: 100%; margin: 0; }
        body{
            background-image:
                linear-gradient(rgba(0,0,0,.62), rgba(0,0,0,.62)),
                url('https://images.unsplash.com/photo-1507525428034-b723cf961d3e?auto=format&amp;fit=crop&amp;w=1920&amp;q=80');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            color: #fff;
        }
        .page-wrap{ min-height:100vh; display:flex; align-items:center; padding: 40px 0; }
        .glass{
            background: rgba(255,255,255,.12);
            border: 1px solid rgba(255,255,255,.18);
            backdrop-filter: blur(10px);
            border-radius: 18px;
            box-shadow: 0 20px 60px rgba(0,0,0,.35);
        }
        .btn-orange{
            background:#ff7a00; border-color:#ff7a00; color:#fff; font-weight:700;
        }
        .btn-orange:hover{ background:#ff9a2f; border-color:#ff9a2f; color:#fff; }
        .btn-main{ min-width: 220px; }
        .hint{ color: rgba(255,255,255,.75); font-size: .92rem; }
        .form-label{ font-weight: 600; }
    </style>
</h:head>

<h:body>
<div class="page-wrap">
    <div class="container">
        <div class="text-center mb-4">
            <h1 class="display-5 fw-bold">Recherche d’informations touristiques</h1>
            <div class="hint">Choisis un type de recherche et ses critères (site ou hôtel).</div>
        </div>

        <div class="glass p-4 p-md-5 mx-auto" style="max-width: 900px;">

            <!-- IMPORTANT : prependId=false pour éviter j_idt... compliqués -->
            <h:form id="searchForm" prependId="false">

                <h:messages styleClass="text-warning fw-semibold" />

                <!-- ✅ CONTENEUR TOUJOURS PRESENT -->
                <h:panelGroup id="zone" layout="block">

                    <div class="row g-3 align-items-end">

                        <!-- TYPE -->
                        <div class="col-12 col-md-6">
                            <h:outputLabel for="typeR" styleClass="form-label">Type de recherche</h:outputLabel>

                            <h:selectOneMenu id="typeR" styleClass="form-select"
                                             value="#{searchBean.typeRecherche}">
                                <f:selectItem itemLabel="-- Choisir --" itemValue="" noSelectionOption="true"/>
                                <f:selectItem itemLabel="Site" itemValue="SITE"/>
                                <f:selectItem itemLabel="Hôtel" itemValue="HOTEL"/>

                                <!-- ✅ On rerender seulement "zone" (toujours présent) -->
                                <f:ajax render="zone" execute="@this"/>
                            </h:selectOneMenu>
                        </div>

                        <!-- ===== SITE ===== -->
                        <h:panelGroup layout="block"
                                      styleClass="col-12 col-md-6"
                                      rendered="#{searchBean.typeRecherche eq 'SITE'}">
                            <h:outputLabel for="motcle" styleClass="form-label">Mot-clé (site)</h:outputLabel>
                            <h:inputText id="motcle" styleClass="form-control"
                                         value="#{searchBean.motCleSite}"
                                         placeholder="Ex: volcan, plage, randonnée"/>
                        </h:panelGroup>

                        <!-- ===== HOTEL (critère) ===== -->
                        <h:panelGroup layout="block"
                                      styleClass="col-12"
                                      rendered="#{searchBean.typeRecherche eq 'HOTEL'}">

                            <div class="row g-3 align-items-end">

                                <div class="col-12 col-md-6">
                                    <h:outputLabel for="crit" styleClass="form-label">Critère hôtel</h:outputLabel>

                                    <h:selectOneMenu id="crit" styleClass="form-select"
                                                     value="#{searchBean.critereHotel}">
                                        <f:selectItem itemLabel="-- Choisir --" itemValue="" noSelectionOption="true"/>
                                        <f:selectItem itemLabel="Nom" itemValue="NOM"/>
                                        <f:selectItem itemLabel="Nombre d’étoiles" itemValue="ETOILES"/>
                                        <f:selectItem itemLabel="Prix / nuit" itemValue="PRIX"/>

                                        <!-- ✅ Encore : on rerender seulement "zone" -->
                                        <f:ajax render="zone" execute="@this"/>
                                    </h:selectOneMenu>
                                </div>

                                <!-- NOM -->
                                <h:panelGroup layout="block"
                                              styleClass="col-12 col-md-6"
                                              rendered="#{searchBean.critereHotel eq 'NOM'}">
                                    <h:outputLabel for="hn" styleClass="form-label">Nom de l’hôtel</h:outputLabel>
                                    <h:inputText id="hn" styleClass="form-control"
                                                 value="#{searchBean.nomHotel}"
                                                 placeholder="Ex: LUX*, Dina Morgabine..."/>
                                </h:panelGroup>

                                <!-- ETOILES -->
                                <h:panelGroup layout="block"
                                              styleClass="col-12 col-md-6"
                                              rendered="#{searchBean.critereHotel eq 'ETOILES'}">
                                    <h:outputLabel for="st" styleClass="form-label">Nombre d’étoiles</h:outputLabel>
                                    <h:selectOneMenu id="st" styleClass="form-select"
                                                     value="#{searchBean.etoiles}">
                                        <f:selectItem itemLabel="-- Choisir --" itemValue="" noSelectionOption="true"/>
                                        <f:selectItem itemLabel="1" itemValue="1"/>
                                        <f:selectItem itemLabel="2" itemValue="2"/>
                                        <f:selectItem itemLabel="3" itemValue="3"/>
                                        <f:selectItem itemLabel="4" itemValue="4"/>
                                        <f:selectItem itemLabel="5" itemValue="5"/>
                                    </h:selectOneMenu>
                                </h:panelGroup>

                                <!-- PRIX -->
                                <h:panelGroup layout="block"
                                              styleClass="col-12"
                                              rendered="#{searchBean.critereHotel eq 'PRIX'}">
                                    <div class="row g-3">
                                        <div class="col-12 col-md-6">
                                            <h:outputLabel for="pmin" styleClass="form-label">Prix min / nuit (€)</h:outputLabel>
                                            <h:inputText id="pmin" styleClass="form-control"
                                                         value="#{searchBean.prixMinNuit}"
                                                         placeholder="Ex : 80"/>
                                        </div>
                                        <div class="col-12 col-md-6">
                                            <h:outputLabel for="pmax" styleClass="form-label">Prix max / nuit (€)</h:outputLabel>
                                            <h:inputText id="pmax" styleClass="form-control"
                                                         value="#{searchBean.prixMaxNuit}"
                                                         placeholder="Ex : 200"/>
                                        </div>
                                        <div class="col-12">
                                            <div class="hint">Tu peux saisir min seul, max seul, ou les deux (min ≤ max).</div>
                                        </div>
                                    </div>
                                </h:panelGroup>

                            </div>
                        </h:panelGroup>

                    </div>
                </h:panelGroup>

                <hr class="my-4" style="border-color: rgba(255,255,255,.25);" />

                <div class="d-flex gap-3 flex-wrap">
                    <h:commandButton value="Rechercher"
                                     action="#{searchBean.rechercher}"
                                     styleClass="btn btn-orange btn-main"/>

                    <h:commandButton value="Réinitialiser"
                                     action="#{searchBean.reset}"
                                     immediate="true"
                                     styleClass="btn btn-outline-light btn-main">
                        <!-- ✅ resetValues vide les valeurs locales JSF -->
                        <f:ajax execute="@this" render="zone" resetValues="true"/>
                    </h:commandButton>

                    <h:button outcome="offer.xhtml" value="Aller aux offres"
                              styleClass="btn btn-orange btn-main"/>
                </div>

                <div class="mt-4">
                    <h3 class="h4 fw-bold">Résultats</h3>
                    <div class="hint">Aucun résultat pour le moment.</div>
                </div>

            </h:form>

        </div>

        <div class="text-center mt-4">
            <h:button outcome="index.xhtml" value="Retour à l’accueil"
                      styleClass="btn btn-outline-light btn-main"/>
        </div>

    </div>
</div>
</h:body>
</html>
